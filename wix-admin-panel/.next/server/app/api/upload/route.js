/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/upload/route";
exports.ids = ["app/api/upload/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/@supabase/realtime-js/dist/main sync recursive":
/*!************************************************************!*\
  !*** ./node_modules/@supabase/realtime-js/dist/main/ sync ***!
  \************************************************************/
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = "(rsc)/./node_modules/@supabase/realtime-js/dist/main sync recursive";
module.exports = webpackEmptyContext;

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "?32c4":
/*!****************************!*\
  !*** bufferutil (ignored) ***!
  \****************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "?66e9":
/*!********************************!*\
  !*** utf-8-validate (ignored) ***!
  \********************************/
/***/ (() => {

/* (ignored) */

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _workspaces_codespaces_blank_wix_admin_panel_src_app_api_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/upload/route.ts */ \"(rsc)/./src/app/api/upload/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/upload/route\",\n        pathname: \"/api/upload\",\n        filename: \"route\",\n        bundlePath: \"app/api/upload/route\"\n    },\n    resolvedPagePath: \"/workspaces/codespaces-blank/wix-admin-panel/src/app/api/upload/route.ts\",\n    nextConfigOutput,\n    userland: _workspaces_codespaces_blank_wix_admin_panel_src_app_api_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZ1cGxvYWQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnVwbG9hZCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnVwbG9hZCUyRnJvdXRlLnRzJmFwcERpcj0lMkZ3b3Jrc3BhY2VzJTJGY29kZXNwYWNlcy1ibGFuayUyRndpeC1hZG1pbi1wYW5lbCUyRnNyYyUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGd29ya3NwYWNlcyUyRmNvZGVzcGFjZXMtYmxhbmslMkZ3aXgtYWRtaW4tcGFuZWwmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ3dCO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGOztBQUUxRiIsInNvdXJjZXMiOlsid2VicGFjazovL3dpeC1hZG1pbi1wYW5lbC8/NzI3MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL3dvcmtzcGFjZXMvY29kZXNwYWNlcy1ibGFuay93aXgtYWRtaW4tcGFuZWwvc3JjL2FwcC9hcGkvdXBsb2FkL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS91cGxvYWQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS91cGxvYWRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3VwbG9hZC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi93b3Jrc3BhY2VzL2NvZGVzcGFjZXMtYmxhbmsvd2l4LWFkbWluLXBhbmVsL3NyYy9hcHAvYXBpL3VwbG9hZC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/upload/route.ts":
/*!*************************************!*\
  !*** ./src/app/api/upload/route.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_wix_media__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/wix-media */ \"(rsc)/./src/lib/wix-media.ts\");\n\n\nasync function POST(request) {\n    try {\n        const formData = await request.formData();\n        const file = formData.get('file');\n        const title = formData.get('title') || 'untitled';\n        const mediaType = formData.get('mediaType') || 'gallery';\n        if (!file) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'No file provided'\n            }, {\n                status: 400\n            });\n        }\n        // Validate file type\n        const allowedTypes = [\n            'image/jpeg',\n            'image/jpg',\n            'image/png',\n            'image/webp',\n            'image/gif'\n        ];\n        if (!allowedTypes.includes(file.type)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'Invalid file type. Only images are allowed.'\n            }, {\n                status: 400\n            });\n        }\n        // Validate file size (max 100MB)\n        const maxSize = 100 * 1024 * 1024; // 100MB\n        if (file.size > maxSize) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'File size too large. Maximum 100MB allowed.'\n            }, {\n                status: 400\n            });\n        }\n        // Override folder ID for gallery vs news\n        const parentFolderIdOverride = mediaType === 'news' ? '9d0082a7e2dc4620a9af0986eacbea56' : 'fdf9fa883af549218a9397534714ad66';\n        // Upload main image and thumbnail into the specified folder\n        const imageResult = await _lib_wix_media__WEBPACK_IMPORTED_MODULE_1__.wixMediaService.uploadImage(file, title, mediaType, parentFolderIdOverride);\n        // Return as MediaItem\n        const mediaItem = {\n            src: imageResult.src,\n            title: imageResult.title,\n            alt: imageResult.alt,\n            type: 'image'\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: mediaItem\n        });\n    } catch (error) {\n        console.error('Upload error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : 'Upload failed'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS91cGxvYWQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXdEO0FBQ047QUFFM0MsZUFBZUUsS0FBS0MsT0FBb0I7SUFDN0MsSUFBSTtRQUNGLE1BQU1DLFdBQVcsTUFBTUQsUUFBUUMsUUFBUTtRQUN2QyxNQUFNQyxPQUFPRCxTQUFTRSxHQUFHLENBQUM7UUFDMUIsTUFBTUMsUUFBUUgsU0FBU0UsR0FBRyxDQUFDLFlBQXNCO1FBQ2pELE1BQU1FLFlBQVlKLFNBQVNFLEdBQUcsQ0FBQyxnQkFBc0M7UUFFckUsSUFBSSxDQUFDRCxNQUFNO1lBQ1QsT0FBT0wscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQUVDLFNBQVM7Z0JBQU9DLE9BQU87WUFBbUIsR0FDNUM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLHFCQUFxQjtRQUNyQixNQUFNQyxlQUFlO1lBQUM7WUFBYztZQUFhO1lBQWE7WUFBYztTQUFZO1FBQ3hGLElBQUksQ0FBQ0EsYUFBYUMsUUFBUSxDQUFDVCxLQUFLVSxJQUFJLEdBQUc7WUFDckMsT0FBT2YscURBQVlBLENBQUNTLElBQUksQ0FDdEI7Z0JBQUVDLFNBQVM7Z0JBQU9DLE9BQU87WUFBOEMsR0FDdkU7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGlDQUFpQztRQUNqQyxNQUFNSSxVQUFVLE1BQU0sT0FBTyxNQUFNLFFBQVE7UUFDM0MsSUFBSVgsS0FBS1ksSUFBSSxHQUFHRCxTQUFTO1lBQ3ZCLE9BQU9oQixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtnQkFBRUMsU0FBUztnQkFBT0MsT0FBTztZQUE4QyxHQUN2RTtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEseUNBQXlDO1FBQ3pDLE1BQU1NLHlCQUF5QlYsY0FBYyxTQUN6QyxxQ0FDQTtRQUNKLDREQUE0RDtRQUM1RCxNQUFNVyxjQUFjLE1BQU1sQiwyREFBZUEsQ0FBQ21CLFdBQVcsQ0FBQ2YsTUFBTUUsT0FBT0MsV0FBV1U7UUFFOUUsc0JBQXNCO1FBQ3RCLE1BQU1HLFlBQVk7WUFDaEJDLEtBQUtILFlBQVlHLEdBQUc7WUFDcEJmLE9BQU9ZLFlBQVlaLEtBQUs7WUFDeEJnQixLQUFLSixZQUFZSSxHQUFHO1lBQ3BCUixNQUFNO1FBQ1I7UUFDQSxPQUFPZixxREFBWUEsQ0FBQ1MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7WUFBTWMsTUFBTUg7UUFBVTtJQUU1RCxFQUFFLE9BQU9WLE9BQU87UUFDZGMsUUFBUWQsS0FBSyxDQUFDLGlCQUFpQkE7UUFDL0IsT0FBT1gscURBQVlBLENBQUNTLElBQUksQ0FDdEI7WUFBRUMsU0FBUztZQUFPQyxPQUFPQSxpQkFBaUJlLFFBQVFmLE1BQU1nQixPQUFPLEdBQUc7UUFBZ0IsR0FDbEY7WUFBRWYsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93aXgtYWRtaW4tcGFuZWwvLi9zcmMvYXBwL2FwaS91cGxvYWQvcm91dGUudHM/NTEyMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgd2l4TWVkaWFTZXJ2aWNlIH0gZnJvbSAnQC9saWIvd2l4LW1lZGlhJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBmb3JtRGF0YSA9IGF3YWl0IHJlcXVlc3QuZm9ybURhdGEoKTtcbiAgICBjb25zdCBmaWxlID0gZm9ybURhdGEuZ2V0KCdmaWxlJykgYXMgRmlsZTtcbiAgICBjb25zdCB0aXRsZSA9IGZvcm1EYXRhLmdldCgndGl0bGUnKSBhcyBzdHJpbmcgfHwgJ3VudGl0bGVkJztcbiAgICBjb25zdCBtZWRpYVR5cGUgPSBmb3JtRGF0YS5nZXQoJ21lZGlhVHlwZScpIGFzICdnYWxsZXJ5JyB8ICduZXdzJyB8fCAnZ2FsbGVyeSc7XG5cbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBmaWxlIHByb3ZpZGVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZmlsZSB0eXBlXG4gICAgY29uc3QgYWxsb3dlZFR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL2pwZycsICdpbWFnZS9wbmcnLCAnaW1hZ2Uvd2VicCcsICdpbWFnZS9naWYnXTtcbiAgICBpZiAoIWFsbG93ZWRUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBmaWxlIHR5cGUuIE9ubHkgaW1hZ2VzIGFyZSBhbGxvd2VkLicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGZpbGUgc2l6ZSAobWF4IDEwME1CKVxuICAgIGNvbnN0IG1heFNpemUgPSAxMDAgKiAxMDI0ICogMTAyNDsgLy8gMTAwTUJcbiAgICBpZiAoZmlsZS5zaXplID4gbWF4U2l6ZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZpbGUgc2l6ZSB0b28gbGFyZ2UuIE1heGltdW0gMTAwTUIgYWxsb3dlZC4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBPdmVycmlkZSBmb2xkZXIgSUQgZm9yIGdhbGxlcnkgdnMgbmV3c1xuICAgIGNvbnN0IHBhcmVudEZvbGRlcklkT3ZlcnJpZGUgPSBtZWRpYVR5cGUgPT09ICduZXdzJ1xuICAgICAgPyAnOWQwMDgyYTdlMmRjNDYyMGE5YWYwOTg2ZWFjYmVhNTYnXG4gICAgICA6ICdmZGY5ZmE4ODNhZjU0OTIxOGE5Mzk3NTM0NzE0YWQ2Nic7XG4gICAgLy8gVXBsb2FkIG1haW4gaW1hZ2UgYW5kIHRodW1ibmFpbCBpbnRvIHRoZSBzcGVjaWZpZWQgZm9sZGVyXG4gICAgY29uc3QgaW1hZ2VSZXN1bHQgPSBhd2FpdCB3aXhNZWRpYVNlcnZpY2UudXBsb2FkSW1hZ2UoZmlsZSwgdGl0bGUsIG1lZGlhVHlwZSwgcGFyZW50Rm9sZGVySWRPdmVycmlkZSk7XG5cbiAgICAvLyBSZXR1cm4gYXMgTWVkaWFJdGVtXG4gICAgY29uc3QgbWVkaWFJdGVtID0ge1xuICAgICAgc3JjOiBpbWFnZVJlc3VsdC5zcmMsXG4gICAgICB0aXRsZTogaW1hZ2VSZXN1bHQudGl0bGUsXG4gICAgICBhbHQ6IGltYWdlUmVzdWx0LmFsdCxcbiAgICAgIHR5cGU6ICdpbWFnZSdcbiAgICB9O1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IG1lZGlhSXRlbSB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1VwbG9hZCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1VwbG9hZCBmYWlsZWQnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwid2l4TWVkaWFTZXJ2aWNlIiwiUE9TVCIsInJlcXVlc3QiLCJmb3JtRGF0YSIsImZpbGUiLCJnZXQiLCJ0aXRsZSIsIm1lZGlhVHlwZSIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJhbGxvd2VkVHlwZXMiLCJpbmNsdWRlcyIsInR5cGUiLCJtYXhTaXplIiwic2l6ZSIsInBhcmVudEZvbGRlcklkT3ZlcnJpZGUiLCJpbWFnZVJlc3VsdCIsInVwbG9hZEltYWdlIiwibWVkaWFJdGVtIiwic3JjIiwiYWx0IiwiZGF0YSIsImNvbnNvbGUiLCJFcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/upload/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase.ts":
/*!*****************************!*\
  !*** ./src/lib/supabase.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   uploadFileToSupabase: () => (/* binding */ uploadFileToSupabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst supabaseKey = process.env.SUPABASE_KEY;\nif (!supabaseUrl || !supabaseKey) {\n    throw new Error('Supabase URL and Key must be defined in your .env.local file');\n}\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseKey);\nconst uploadFileToSupabase = async (file, bucket, fileName)=>{\n    const { data, error } = await supabase.storage.from(bucket).upload(fileName, file, {\n        cacheControl: '3600',\n        upsert: false\n    });\n    if (error) {\n        throw new Error(`Supabase upload failed: ${error.message}`);\n    }\n    const { data: { publicUrl } } = supabase.storage.from(bucket).getPublicUrl(fileName);\n    return publicUrl;\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabase);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFxRDtBQUVyRCxNQUFNQyxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLFlBQVk7QUFDNUMsTUFBTUMsY0FBY0gsUUFBUUMsR0FBRyxDQUFDRyxZQUFZO0FBRTVDLElBQUksQ0FBQ0wsZUFBZSxDQUFDSSxhQUFhO0lBQ2hDLE1BQU0sSUFBSUUsTUFBTTtBQUNsQjtBQUVBLE1BQU1DLFdBQVdSLG1FQUFZQSxDQUFDQyxhQUFhSTtBQUVwQyxNQUFNSSx1QkFBdUIsT0FBT0MsTUFBWUMsUUFBZ0JDO0lBQ3JFLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNTixTQUFTTyxPQUFPLENBQzNDQyxJQUFJLENBQUNMLFFBQ0xNLE1BQU0sQ0FBQ0wsVUFBVUYsTUFBTTtRQUN0QlEsY0FBYztRQUNkQyxRQUFRO0lBQ1Y7SUFFRixJQUFJTCxPQUFPO1FBQ1QsTUFBTSxJQUFJUCxNQUFNLENBQUMsd0JBQXdCLEVBQUVPLE1BQU1NLE9BQU8sRUFBRTtJQUM1RDtJQUVBLE1BQU0sRUFBRVAsTUFBTSxFQUFFUSxTQUFTLEVBQUUsRUFBRSxHQUFHYixTQUFTTyxPQUFPLENBQUNDLElBQUksQ0FBQ0wsUUFBUVcsWUFBWSxDQUFDVjtJQUUzRSxPQUFPUztBQUNULEVBQUU7QUFFRixpRUFBZWIsUUFBUUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3dpeC1hZG1pbi1wYW5lbC8uL3NyYy9saWIvc3VwYWJhc2UudHM/MDZlMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTDtcbmNvbnN0IHN1cGFiYXNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfS0VZO1xuXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUtleSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIFVSTCBhbmQgS2V5IG11c3QgYmUgZGVmaW5lZCBpbiB5b3VyIC5lbnYubG9jYWwgZmlsZScpO1xufVxuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkpO1xuXG5leHBvcnQgY29uc3QgdXBsb2FkRmlsZVRvU3VwYWJhc2UgPSBhc3luYyAoZmlsZTogRmlsZSwgYnVja2V0OiBzdHJpbmcsIGZpbGVOYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxuICAgIC5mcm9tKGJ1Y2tldClcbiAgICAudXBsb2FkKGZpbGVOYW1lLCBmaWxlLCB7XG4gICAgICBjYWNoZUNvbnRyb2w6ICczNjAwJyxcbiAgICAgIHVwc2VydDogZmFsc2UsXG4gICAgfSk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdXBhYmFzZSB1cGxvYWQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gIH1cblxuICBjb25zdCB7IGRhdGE6IHsgcHVibGljVXJsIH0gfSA9IHN1cGFiYXNlLnN0b3JhZ2UuZnJvbShidWNrZXQpLmdldFB1YmxpY1VybChmaWxlTmFtZSk7XG5cbiAgcmV0dXJuIHB1YmxpY1VybDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHN1cGFiYXNlO1xuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiU1VQQUJBU0VfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsInVwbG9hZEZpbGVUb1N1cGFiYXNlIiwiZmlsZSIsImJ1Y2tldCIsImZpbGVOYW1lIiwiZGF0YSIsImVycm9yIiwic3RvcmFnZSIsImZyb20iLCJ1cGxvYWQiLCJjYWNoZUNvbnRyb2wiLCJ1cHNlcnQiLCJtZXNzYWdlIiwicHVibGljVXJsIiwiZ2V0UHVibGljVXJsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/wix-media.ts":
/*!******************************!*\
  !*** ./src/lib/wix-media.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WixMediaService: () => (/* binding */ WixMediaService),\n/* harmony export */   wixMediaService: () => (/* binding */ wixMediaService)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./src/lib/supabase.ts\");\n\nconst WIX_API_KEY = process.env.WIX_API_KEY;\nconst WIX_SITE_ID = process.env.WIX_SITE_ID;\nconst WIX_ACCOUNT_ID = process.env.WIX_ACCOUNT_ID;\nclass WixMediaService {\n    /**\n   * Generate folder path based on type/year/month/title structure\n   * @param title - The title to use for the folder\n   * @param mediaType - The type of media (gallery or news)\n   * @returns Folder path in format: /gallery|news/YYYY/MM/sanitized-title\n   */ generateFolderPath(title, mediaType) {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        // For news, skip slug, use only date path\n        if (mediaType === 'news') {\n            return `/${mediaType}/${year}/${month}`;\n        }\n        // Sanitize title for gallery folder slug\n        const sanitizedTitle = title.toLowerCase().replace(/[^a-z0-9\\s-]/g, '').replace(/\\s+/g, '-').replace(/-+/g, '-').replace(/^-+|-+$/g, ''); // Remove leading/trailing dashes\n        return `/${mediaType}/${year}/${month}/${sanitizedTitle}`;\n    }\n    /**\n   * Create folder in WIX Media Manager using hierarchical structure\n   * @param folderPath - The folder path to create (e.g., \"/gallery/2025/06/summer-photos\")\n   * @returns Folder ID or null if creation failed\n   */ async ensureFolderExists(folderPath) {\n        try {\n            const pathParts = folderPath.split('/').filter((part)=>part.length > 0);\n            let currentParentId = 'MEDIA_ROOT'; // Default root folder ID\n            // Create each folder in the hierarchy\n            for (const folderName of pathParts){\n                // First, check if folder already exists\n                const listResponse = await fetch(`${this.baseUrl}/folders?parentFolderId=${currentParentId}`, {\n                    method: 'GET',\n                    headers: this.headers\n                });\n                let folderId = null;\n                if (listResponse.ok) {\n                    const foldersData = await listResponse.json();\n                    const existingFolder = foldersData.folders?.find((f)=>f.displayName === folderName);\n                    if (existingFolder) {\n                        folderId = existingFolder.id;\n                    }\n                }\n                // Create folder if it doesn't exist\n                if (!folderId) {\n                    const createResponse = await fetch(`${this.baseUrl}/folders`, {\n                        method: 'POST',\n                        headers: this.headers,\n                        body: JSON.stringify({\n                            displayName: folderName,\n                            parentFolderId: currentParentId\n                        })\n                    });\n                    if (createResponse.ok) {\n                        const folderData = await createResponse.json();\n                        folderId = folderData.folder.id;\n                    } else {\n                        console.error('Failed to create folder:', folderName);\n                        return null;\n                    }\n                }\n                currentParentId = folderId;\n            }\n            return currentParentId;\n        } catch (error) {\n            console.error('Error ensuring folder exists:', error);\n            return null;\n        }\n    }\n    /**\n   * Convert file to blob URL for uploading\n   * @param file - The file to convert\n   * @returns Promise resolving to blob URL string\n   */ async fileToBlobUrl(file) {\n        return new Promise((resolve, reject)=>{\n            try {\n                // Create a temporary blob URL for the file\n                const blobUrl = URL.createObjectURL(file);\n                resolve(blobUrl);\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n    /**\n   * Upload image to WIX Media Manager using import API\n   * @param file - The file to upload\n   * @param title - Title for organizing the file\n   * @param mediaType - Type of media (gallery or news)\n   * @param parentFolderIdOverride - Optional explicit folder ID to use instead of creating a new path\n   * @returns Upload response with WIX media URL\n   */ async uploadImage(file, title, mediaType = 'gallery', parentFolderIdOverride) {\n        try {\n            const folderPath = this.generateFolderPath(title, mediaType);\n            // Use override if provided, otherwise ensure folder exists\n            const folderId = parentFolderIdOverride ?? await this.ensureFolderExists(folderPath);\n            // Upload to Supabase to get a public URL\n            console.log(`Uploading file to Supabase: ${file.name}`);\n            const bucket = mediaType;\n            // Generate unique filename based on current timestamp\n            const ext = file.name.split('.').pop() || '';\n            const uniqueFilename = `${Date.now() * 1000}.${ext}`;\n            const supabaseFilePath = `${folderPath}/${uniqueFilename}`.replace(/^\\//, '');\n            const publicUrl = await (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.uploadFileToSupabase)(file, bucket, supabaseFilePath);\n            // Import file using the single import API with the public URL\n            const importPayload = {\n                url: publicUrl,\n                displayName: title,\n                parentFolderId: folderId || 'media-root',\n                mimeType: file.type,\n                mediaType: 'IMAGE',\n                private: false\n            };\n            console.log('Wix import headers:', this.headers);\n            console.log('Wix import payload:', importPayload);\n            const importResponse = await fetch(`${this.baseUrl}/files/import`, {\n                method: 'POST',\n                headers: this.headers,\n                body: JSON.stringify(importPayload)\n            });\n            if (!importResponse.ok) {\n                const errorText = await importResponse.text();\n                throw new Error(`Failed to import file: ${importResponse.status} ${importResponse.statusText} - ${errorText}`);\n            }\n            let importResult;\n            try {\n                importResult = await importResponse.json();\n            } catch (parseError) {\n                const text = await importResponse.text();\n                throw new Error(`Import failed with non-JSON response: ${text}`);\n            }\n            if (!importResult.file) {\n                throw new Error('Import response missing file data');\n            }\n            const uploadedFile = importResult.file;\n            // Return in the expected format\n            return {\n                src: uploadedFile.url,\n                title: uniqueFilename,\n                alt: uniqueFilename,\n                type: 'image'\n            };\n        } catch (error) {\n            console.error('WIX Media upload error:', error);\n            throw error;\n        }\n    }\n    /**\n   * Convert file to data URL\n   * @param file - The file to convert\n   * @returns Promise resolving to data URL string\n   */ fileToDataUrl(file) {\n        return new Promise((resolve, reject)=>{\n            const reader = new FileReader();\n            reader.onload = ()=>resolve(reader.result);\n            reader.onerror = reject;\n            reader.readAsDataURL(file);\n        });\n    }\n    /**\n   * Upload thumbnail image to WIX Media Manager\n   * @param file - The thumbnail file to upload\n   * @param title - Title for organizing the file\n   * @param mediaType - Type of media (gallery or news)\n   * @returns Upload response with WIX media URL\n   */ async uploadThumbnail(file, title, mediaType = 'gallery', parentFolderIdOverride) {\n        try {\n            const folderPath = this.generateFolderPath(title, mediaType);\n            // Generate unique timestamp-based filename for thumbnail\n            const extThumb = file.name.split('.').pop() || '';\n            const uniqueThumbName = `${Date.now() * 1000}.${extThumb}`;\n            const bucket = mediaType;\n            const supabaseFilePath = `${folderPath}/${uniqueThumbName}`.replace(/^[\\\\/]/, '');\n            const publicUrl = await (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.uploadFileToSupabase)(file, bucket, supabaseFilePath);\n            const importPayload = {\n                url: publicUrl,\n                displayName: `${title}-thumbnail`,\n                parentFolderId: (parentFolderIdOverride ?? await this.ensureFolderExists(folderPath)) || 'media-root',\n                mimeType: file.type,\n                mediaType: 'IMAGE',\n                private: false\n            };\n            const importResponse = await fetch(`${this.baseUrl}/files/import`, {\n                method: 'POST',\n                headers: this.headers,\n                body: JSON.stringify(importPayload)\n            });\n            if (!importResponse.ok) {\n                const errorText = await importResponse.text();\n                throw new Error(`Failed to import thumbnail: ${importResponse.status} ${importResponse.statusText} - ${errorText}`);\n            }\n            const importResult = await importResponse.json();\n            if (!importResult.file) {\n                throw new Error('Import response missing file data');\n            }\n            // Cleanup deferred: keep thumbnail temp file in Supabase until gallery/news is saved\n            return {\n                id: importResult.file.id,\n                url: importResult.file.url,\n                filename: uniqueThumbName,\n                path: folderPath,\n                mediaType: importResult.file.mediaType.toLowerCase(),\n                uploaded: importResult.file.createdDate\n            };\n        } catch (error) {\n            console.error('WIX Media thumbnail upload error:', error);\n            throw error;\n        }\n    }\n    /**\n   * Bulk import files to WIX Media Manager\n   * @param files - Array of files to upload\n   * @param title - Title for organizing the files\n   * @param mediaType - Type of media (gallery or news)\n   * @returns Array of upload responses\n   */ async bulkUploadImages(files, title, mediaType = 'gallery') {\n        try {\n            if (files.length === 0) {\n                return [];\n            }\n            if (files.length > 100) {\n                throw new Error('Cannot upload more than 100 files at once (WIX API limit)');\n            }\n            const folderPath = this.generateFolderPath(title, mediaType);\n            // Ensure folder exists\n            const folderId = await this.ensureFolderExists(folderPath);\n            // Prepare import requests by uploading each file to temporary hosting\n            console.log(`Preparing to upload ${files.length} files...`);\n            const importFileRequests = await Promise.all(files.map(async (file, index)=>{\n                console.log(`Uploading file ${index + 1}/${files.length}: ${file.name}`);\n                const bucket = mediaType;\n                // Generate unique filename based on current timestamp\n                const ext = file.name.split('.').pop() || '';\n                const uniqueFilename = `${Date.now() * 1000}.${ext}`;\n                const supabaseFilePath = `${folderPath}/${uniqueFilename}`.replace(/^\\//, '');\n                const publicUrl = await (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.uploadFileToSupabase)(file, bucket, supabaseFilePath);\n                return {\n                    url: publicUrl,\n                    displayName: file.name,\n                    parentFolderId: folderId || 'MEDIA_ROOT',\n                    mimeType: file.type,\n                    mediaType: 'IMAGE',\n                    private: false\n                };\n            }));\n            console.log('Starting bulk import to WIX Media Manager...');\n            // Bulk import using the bulk import API\n            const bulkImportResponse = await fetch(`${this.baseUrl}/bulk/files/import-v2`, {\n                method: 'POST',\n                headers: this.headers,\n                body: JSON.stringify({\n                    importFileRequests,\n                    returnEntity: true\n                })\n            });\n            // Parse and handle bulk import response\n            if (!bulkImportResponse.ok) {\n                const errText = await bulkImportResponse.text();\n                throw new Error(`Failed to bulk import files: ${bulkImportResponse.status} ${bulkImportResponse.statusText} - ${errText}`);\n            }\n            const bulkImportResult = await bulkImportResponse.json();\n            const uploadResponses = [];\n            const errors = [];\n            bulkImportResult.results.forEach((result, index)=>{\n                if (result.success && result.success.file) {\n                    const fileData = result.success.file;\n                    uploadResponses.push({\n                        id: fileData.id,\n                        url: fileData.url,\n                        filename: files[index].name,\n                        path: folderPath,\n                        mediaType: fileData.mediaType.toLowerCase(),\n                        uploaded: fileData.createdDate\n                    });\n                } else if (result.failure) {\n                    const msg = `Failed to upload ${files[index].name}: ${result.failure.message}`;\n                    console.error(msg, result.failure);\n                    errors.push(msg);\n                }\n            });\n            if (errors.length > 0 && uploadResponses.length === 0) {\n                throw new Error(`All file uploads failed:\\n${errors.join('\\n')}`);\n            }\n            if (errors.length > 0) console.warn(`Some files failed to upload:\\n${errors.join('\\n')}`);\n            return uploadResponses;\n        } catch (error) {\n            console.error('WIX Media bulk upload error:', error);\n            throw error;\n        }\n    }\n    /**\n   * Delete media from WIX Media Manager\n   * @param mediaId - The WIX media ID to delete\n   * @returns Success boolean\n   */ async deleteMedia(mediaId) {\n        try {\n            const response = await fetch(`${this.baseUrl}/files/${mediaId}`, {\n                method: 'DELETE',\n                headers: this.headers\n            });\n            return response.ok;\n        } catch (error) {\n            console.error('WIX Media deletion error:', error);\n            return false;\n        }\n    }\n    /**\n   * Get media item details\n   * @param mediaId - The WIX media ID\n   * @returns Media item details\n   */ async getMediaDetails(mediaId) {\n        try {\n            const response = await fetch(`${this.baseUrl}/files/${mediaId}`, {\n                method: 'GET',\n                headers: this.headers\n            });\n            if (!response.ok) {\n                return null;\n            }\n            const data = await response.json();\n            return {\n                id: data.file.id,\n                url: data.file.url,\n                filename: data.file.displayName,\n                path: data.file.parentFolderId || '',\n                mediaType: data.file.mediaType,\n                uploaded: data.file.createdDate\n            };\n        } catch (error) {\n            console.error('WIX Media get details error:', error);\n            return null;\n        }\n    }\n    /**\n   * List media files with optional filtering\n   * @param folderId - Optional folder ID to filter by\n   * @returns Array of media items\n   */ async listMedia(folderId) {\n        try {\n            const queryParams = new URLSearchParams();\n            if (folderId) {\n                queryParams.append('parentFolderId', folderId);\n            }\n            const response = await fetch(`${this.baseUrl}/files?${queryParams.toString()}`, {\n                method: 'GET',\n                headers: this.headers\n            });\n            if (!response.ok) {\n                throw new Error(`Failed to list media: ${response.statusText}`);\n            }\n            const data = await response.json();\n            return data.files.map((file)=>({\n                    id: file.id,\n                    url: file.url,\n                    filename: file.displayName,\n                    path: file.parentFolderId || '',\n                    mediaType: file.mediaType,\n                    uploaded: file.createdDate\n                }));\n        } catch (error) {\n            console.error('WIX Media list error:', error);\n            return [];\n        }\n    }\n    /**\n   * List folders in Media Manager\n   * @param parentFolderId - Optional parent folder ID\n   * @returns Array of folder information\n   */ async listFolders(parentFolderId) {\n        try {\n            const queryParams = new URLSearchParams();\n            if (parentFolderId) {\n                queryParams.append('parentFolderId', parentFolderId);\n            }\n            const response = await fetch(`${this.baseUrl}/folders?${queryParams.toString()}`, {\n                method: 'GET',\n                headers: this.headers\n            });\n            if (!response.ok) {\n                throw new Error(`Failed to list folders: ${response.statusText}`);\n            }\n            const data = await response.json();\n            return data.folders || [];\n        } catch (error) {\n            console.error('WIX Media list folders error:', error);\n            return [];\n        }\n    }\n    /**\n   * Recursively list all folders under a given parent\n   * @param parentFolderId - starting folder id\n   * @returns flat array of all subfolders\n   */ async listAllFolders(parentFolderId = 'media-root') {\n        const all = [];\n        const queue = [\n            parentFolderId\n        ];\n        while(queue.length){\n            const current = queue.shift();\n            const children = await this.listFolders(current);\n            for (const child of children){\n                all.push(child);\n                queue.push(child.id);\n            }\n        }\n        return all;\n    }\n    /**\n   * Get folder details\n   * @param folderId - The folder ID\n   * @returns Folder details\n   */ async getFolderDetails(folderId) {\n        try {\n            const response = await fetch(`${this.baseUrl}/folders/${folderId}`, {\n                method: 'GET',\n                headers: this.headers\n            });\n            if (!response.ok) {\n                return null;\n            }\n            const data = await response.json();\n            return data.folder;\n        } catch (error) {\n            console.error('WIX Media get folder details error:', error);\n            return null;\n        }\n    }\n    /**\n   * Create a folder in WIX Media Manager\n   * @param displayName - The folder display name\n   * @param parentFolderId - Optional parent folder ID (defaults to media-root)\n   * @returns Success boolean\n   */ async createFolder(displayName, parentFolderId = 'media-root') {\n        try {\n            const response = await fetch(`${this.baseUrl}/folders`, {\n                method: 'POST',\n                headers: this.headers,\n                body: JSON.stringify({\n                    displayName,\n                    parentFolderId\n                })\n            });\n            if (response.ok) {\n                const data = await response.json();\n                return data.folder.id;\n            }\n            return null;\n        } catch (error) {\n            console.error('WIX Media create folder error:', error);\n            return null;\n        }\n    }\n    /**\n   * Generate thumbnail URL for WIX media\n   * @param mediaUrl - The original media URL\n   * @param width - Thumbnail width\n   * @param height - Thumbnail height\n   * @returns Thumbnail URL\n   */ getThumbnailUrl(mediaUrl, width = 300, height = 300) {\n        // WIX media URLs can be modified with query parameters for resizing\n        const url = new URL(mediaUrl);\n        url.searchParams.set('w', width.toString());\n        url.searchParams.set('h', height.toString());\n        url.searchParams.set('fit', 'crop');\n        return url.toString();\n    }\n    constructor(){\n        this.baseUrl = 'https://www.wixapis.com/site-media/v1';\n        this.headers = {\n            'Authorization': `Bearer ${WIX_API_KEY}`,\n            'wix-account-id': WIX_ACCOUNT_ID,\n            'wix-site-id': WIX_SITE_ID,\n            'Content-Type': 'application/json'\n        };\n    }\n}\nconst wixMediaService = new WixMediaService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUliLElBQUlvRjtRQUNwQnZFLElBQUkwRSxZQUFZLENBQUNDLEdBQUcsQ0FBQyxLQUFLSCxNQUFNWixRQUFRO1FBQ3hDNUQsSUFBSTBFLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLEtBQUtGLE9BQU9iLFFBQVE7UUFDekM1RCxJQUFJMEUsWUFBWSxDQUFDQyxHQUFHLENBQUMsT0FBTztRQUM1QixPQUFPM0UsSUFBSTRELFFBQVE7SUFDckI7O2FBNWlCUXJHLFVBQVU7YUFDVkUsVUFBVTtZQUNoQixpQkFBaUIsQ0FBQyxPQUFPLEVBQUVqQyxhQUFhO1lBQ3hDLGtCQUFrQkk7WUFDbEIsZUFBZUQ7WUFDZixnQkFBZ0I7UUFDbEI7O0FBdWlCRjtBQUVPLE1BQU1pSixrQkFBa0IsSUFBSS9JLGtCQUFrQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dpeC1hZG1pbi1wYW5lbC8uL3NyYy9saWIvd2l4LW1lZGlhLnRzPzBmMTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgV2l4TWVkaWFSZXNwb25zZSwgV2l4Rm9sZGVyLCBXaXhGaWxlLCBJbXBvcnRGaWxlUmVxdWVzdCwgQnVsa0ltcG9ydFJlc3BvbnNlIH0gZnJvbSAnQC90eXBlcyc7XG5pbXBvcnQgeyB1cGxvYWRGaWxlVG9TdXBhYmFzZSB9IGZyb20gJy4vc3VwYWJhc2UnO1xuaW1wb3J0IHN1cGFiYXNlIGZyb20gJy4vc3VwYWJhc2UnO1xuXG5jb25zdCBXSVhfQVBJX0tFWSA9IHByb2Nlc3MuZW52LldJWF9BUElfS0VZITtcbmNvbnN0IFdJWF9TSVRFX0lEID0gcHJvY2Vzcy5lbnYuV0lYX1NJVEVfSUQhO1xuY29uc3QgV0lYX0FDQ09VTlRfSUQgPSBwcm9jZXNzLmVudi5XSVhfQUNDT1VOVF9JRCE7XG5cbmV4cG9ydCBjbGFzcyBXaXhNZWRpYVNlcnZpY2Uge1xuICBwcml2YXRlIGJhc2VVcmwgPSAnaHR0cHM6Ly93d3cud2l4YXBpcy5jb20vc2l0ZS1tZWRpYS92MSc7XG4gIHByaXZhdGUgaGVhZGVycyA9IHtcbiAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtXSVhfQVBJX0tFWX1gLFxuICAgICd3aXgtYWNjb3VudC1pZCc6IFdJWF9BQ0NPVU5UX0lELFxuICAgICd3aXgtc2l0ZS1pZCc6IFdJWF9TSVRFX0lELFxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gIH07XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGZvbGRlciBwYXRoIGJhc2VkIG9uIHR5cGUveWVhci9tb250aC90aXRsZSBzdHJ1Y3R1cmVcbiAgICogQHBhcmFtIHRpdGxlIC0gVGhlIHRpdGxlIHRvIHVzZSBmb3IgdGhlIGZvbGRlclxuICAgKiBAcGFyYW0gbWVkaWFUeXBlIC0gVGhlIHR5cGUgb2YgbWVkaWEgKGdhbGxlcnkgb3IgbmV3cylcbiAgICogQHJldHVybnMgRm9sZGVyIHBhdGggaW4gZm9ybWF0OiAvZ2FsbGVyeXxuZXdzL1lZWVkvTU0vc2FuaXRpemVkLXRpdGxlXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlRm9sZGVyUGF0aCh0aXRsZTogc3RyaW5nLCBtZWRpYVR5cGU6ICdnYWxsZXJ5JyB8ICduZXdzJyk6IHN0cmluZyB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG4gICAgY29uc3QgbW9udGggPSBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIFxuICAgIC8vIEZvciBuZXdzLCBza2lwIHNsdWcsIHVzZSBvbmx5IGRhdGUgcGF0aFxuICAgIGlmIChtZWRpYVR5cGUgPT09ICduZXdzJykge1xuICAgICAgcmV0dXJuIGAvJHttZWRpYVR5cGV9LyR7eWVhcn0vJHttb250aH1gO1xuICAgIH1cbiAgICAvLyBTYW5pdGl6ZSB0aXRsZSBmb3IgZ2FsbGVyeSBmb2xkZXIgc2x1Z1xuICAgIGNvbnN0IHNhbml0aXplZFRpdGxlID0gdGl0bGVcbiAgICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgICAucmVwbGFjZSgvW15hLXowLTlcXHMtXS9nLCAnJylcbiAgICAgIC5yZXBsYWNlKC9cXHMrL2csICctJylcbiAgICAgIC5yZXBsYWNlKC8tKy9nLCAnLScpXG4gICAgICAucmVwbGFjZSgvXi0rfC0rJC9nLCAnJyk7IC8vIFJlbW92ZSBsZWFkaW5nL3RyYWlsaW5nIGRhc2hlc1xuICAgIFxuICAgIHJldHVybiBgLyR7bWVkaWFUeXBlfS8ke3llYXJ9LyR7bW9udGh9LyR7c2FuaXRpemVkVGl0bGV9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgZm9sZGVyIGluIFdJWCBNZWRpYSBNYW5hZ2VyIHVzaW5nIGhpZXJhcmNoaWNhbCBzdHJ1Y3R1cmVcbiAgICogQHBhcmFtIGZvbGRlclBhdGggLSBUaGUgZm9sZGVyIHBhdGggdG8gY3JlYXRlIChlLmcuLCBcIi9nYWxsZXJ5LzIwMjUvMDYvc3VtbWVyLXBob3Rvc1wiKVxuICAgKiBAcmV0dXJucyBGb2xkZXIgSUQgb3IgbnVsbCBpZiBjcmVhdGlvbiBmYWlsZWRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZW5zdXJlRm9sZGVyRXhpc3RzKGZvbGRlclBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXRoUGFydHMgPSBmb2xkZXJQYXRoLnNwbGl0KCcvJykuZmlsdGVyKHBhcnQgPT4gcGFydC5sZW5ndGggPiAwKTtcbiAgICAgIGxldCBjdXJyZW50UGFyZW50SWQgPSAnTUVESUFfUk9PVCc7IC8vIERlZmF1bHQgcm9vdCBmb2xkZXIgSURcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGVhY2ggZm9sZGVyIGluIHRoZSBoaWVyYXJjaHlcbiAgICAgIGZvciAoY29uc3QgZm9sZGVyTmFtZSBvZiBwYXRoUGFydHMpIHtcbiAgICAgICAgLy8gRmlyc3QsIGNoZWNrIGlmIGZvbGRlciBhbHJlYWR5IGV4aXN0c1xuICAgICAgICBjb25zdCBsaXN0UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2ZvbGRlcnM/cGFyZW50Rm9sZGVySWQ9JHtjdXJyZW50UGFyZW50SWR9YCwge1xuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZm9sZGVySWQgPSBudWxsO1xuICAgICAgICBpZiAobGlzdFJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgY29uc3QgZm9sZGVyc0RhdGEgPSBhd2FpdCBsaXN0UmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nRm9sZGVyID0gZm9sZGVyc0RhdGEuZm9sZGVycz8uZmluZCgoZjogYW55KSA9PiBmLmRpc3BsYXlOYW1lID09PSBmb2xkZXJOYW1lKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmdGb2xkZXIpIHtcbiAgICAgICAgICAgIGZvbGRlcklkID0gZXhpc3RpbmdGb2xkZXIuaWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIGZvbGRlciBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGlmICghZm9sZGVySWQpIHtcbiAgICAgICAgICBjb25zdCBjcmVhdGVSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vZm9sZGVyc2AsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogZm9sZGVyTmFtZSxcbiAgICAgICAgICAgICAgcGFyZW50Rm9sZGVySWQ6IGN1cnJlbnRQYXJlbnRJZCxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKGNyZWF0ZVJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zdCBmb2xkZXJEYXRhID0gYXdhaXQgY3JlYXRlUmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgZm9sZGVySWQgPSBmb2xkZXJEYXRhLmZvbGRlci5pZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBmb2xkZXI6JywgZm9sZGVyTmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50UGFyZW50SWQgPSBmb2xkZXJJZDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGN1cnJlbnRQYXJlbnRJZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW5zdXJpbmcgZm9sZGVyIGV4aXN0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCBmaWxlIHRvIGJsb2IgVVJMIGZvciB1cGxvYWRpbmdcbiAgICogQHBhcmFtIGZpbGUgLSBUaGUgZmlsZSB0byBjb252ZXJ0XG4gICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGJsb2IgVVJMIHN0cmluZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBmaWxlVG9CbG9iVXJsKGZpbGU6IEZpbGUpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBDcmVhdGUgYSB0ZW1wb3JhcnkgYmxvYiBVUkwgZm9yIHRoZSBmaWxlXG4gICAgICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpO1xuICAgICAgICByZXNvbHZlKGJsb2JVcmwpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGxvYWQgaW1hZ2UgdG8gV0lYIE1lZGlhIE1hbmFnZXIgdXNpbmcgaW1wb3J0IEFQSVxuICAgKiBAcGFyYW0gZmlsZSAtIFRoZSBmaWxlIHRvIHVwbG9hZFxuICAgKiBAcGFyYW0gdGl0bGUgLSBUaXRsZSBmb3Igb3JnYW5pemluZyB0aGUgZmlsZVxuICAgKiBAcGFyYW0gbWVkaWFUeXBlIC0gVHlwZSBvZiBtZWRpYSAoZ2FsbGVyeSBvciBuZXdzKVxuICAgKiBAcGFyYW0gcGFyZW50Rm9sZGVySWRPdmVycmlkZSAtIE9wdGlvbmFsIGV4cGxpY2l0IGZvbGRlciBJRCB0byB1c2UgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBwYXRoXG4gICAqIEByZXR1cm5zIFVwbG9hZCByZXNwb25zZSB3aXRoIFdJWCBtZWRpYSBVUkxcbiAgICovXG4gIGFzeW5jIHVwbG9hZEltYWdlKFxuICAgIGZpbGU6IEZpbGUsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBtZWRpYVR5cGU6ICdnYWxsZXJ5JyB8ICduZXdzJyA9ICdnYWxsZXJ5JyxcbiAgICBwYXJlbnRGb2xkZXJJZE92ZXJyaWRlPzogc3RyaW5nXG4gICk6IFByb21pc2U8eyBzcmM6IHN0cmluZzsgdGl0bGU6IHN0cmluZzsgYWx0OiBzdHJpbmc7IHR5cGU6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZvbGRlclBhdGggPSB0aGlzLmdlbmVyYXRlRm9sZGVyUGF0aCh0aXRsZSwgbWVkaWFUeXBlKTtcbiAgICAgIC8vIFVzZSBvdmVycmlkZSBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIGVuc3VyZSBmb2xkZXIgZXhpc3RzXG4gICAgICBjb25zdCBmb2xkZXJJZCA9IHBhcmVudEZvbGRlcklkT3ZlcnJpZGUgPz8gKGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKGZvbGRlclBhdGgpKTtcblxuICAgICAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIHRvIGdldCBhIHB1YmxpYyBVUkxcbiAgICAgIGNvbnNvbGUubG9nKGBVcGxvYWRpbmcgZmlsZSB0byBTdXBhYmFzZTogJHtmaWxlLm5hbWV9YCk7XG4gICAgICBjb25zdCBidWNrZXQgPSBtZWRpYVR5cGU7XG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgZmlsZW5hbWUgYmFzZWQgb24gY3VycmVudCB0aW1lc3RhbXBcbiAgICAgIGNvbnN0IGV4dCA9IGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpIHx8ICcnO1xuICAgICAgY29uc3QgdW5pcXVlRmlsZW5hbWUgPSBgJHtEYXRlLm5vdygpICogMTAwMH0uJHtleHR9YDtcbiAgICAgIGNvbnN0IHN1cGFiYXNlRmlsZVBhdGggPSBgJHtmb2xkZXJQYXRofS8ke3VuaXF1ZUZpbGVuYW1lfWAucmVwbGFjZSgvXlxcLy8sICcnKTtcbiAgICAgIGNvbnN0IHB1YmxpY1VybCA9IGF3YWl0IHVwbG9hZEZpbGVUb1N1cGFiYXNlKGZpbGUsIGJ1Y2tldCwgc3VwYWJhc2VGaWxlUGF0aCk7XG4gICAgICBcbiAgICAgIC8vIEltcG9ydCBmaWxlIHVzaW5nIHRoZSBzaW5nbGUgaW1wb3J0IEFQSSB3aXRoIHRoZSBwdWJsaWMgVVJMXG4gICAgICBjb25zdCBpbXBvcnRQYXlsb2FkOiBJbXBvcnRGaWxlUmVxdWVzdCA9IHtcbiAgICAgICAgdXJsOiBwdWJsaWNVcmwsXG4gICAgICAgIGRpc3BsYXlOYW1lOiB0aXRsZSxcbiAgICAgICAgcGFyZW50Rm9sZGVySWQ6IGZvbGRlcklkIHx8ICdtZWRpYS1yb290JyxcbiAgICAgICAgbWltZVR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgbWVkaWFUeXBlOiAnSU1BR0UnLFxuICAgICAgICBwcml2YXRlOiBmYWxzZSxcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZygnV2l4IGltcG9ydCBoZWFkZXJzOicsIHRoaXMuaGVhZGVycyk7XG4gICAgICBjb25zb2xlLmxvZygnV2l4IGltcG9ydCBwYXlsb2FkOicsIGltcG9ydFBheWxvYWQpO1xuXG4gICAgICBjb25zdCBpbXBvcnRSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vZmlsZXMvaW1wb3J0YCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShpbXBvcnRQYXlsb2FkKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWltcG9ydFJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IGltcG9ydFJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gaW1wb3J0IGZpbGU6ICR7aW1wb3J0UmVzcG9uc2Uuc3RhdHVzfSAke2ltcG9ydFJlc3BvbnNlLnN0YXR1c1RleHR9IC0gJHtlcnJvclRleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIGxldCBpbXBvcnRSZXN1bHQ6IGFueTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGltcG9ydFJlc3VsdCA9IGF3YWl0IGltcG9ydFJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGltcG9ydFJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbXBvcnQgZmFpbGVkIHdpdGggbm9uLUpTT04gcmVzcG9uc2U6ICR7dGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpbXBvcnRSZXN1bHQuZmlsZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ltcG9ydCByZXNwb25zZSBtaXNzaW5nIGZpbGUgZGF0YScpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1cGxvYWRlZEZpbGUgPSBpbXBvcnRSZXN1bHQuZmlsZTtcblxuICAgICAgLy8gUmV0dXJuIGluIHRoZSBleHBlY3RlZCBmb3JtYXRcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNyYzogdXBsb2FkZWRGaWxlLnVybCxcbiAgICAgICAgdGl0bGU6IHVuaXF1ZUZpbGVuYW1lLFxuICAgICAgICBhbHQ6IHVuaXF1ZUZpbGVuYW1lLFxuICAgICAgICB0eXBlOiAnaW1hZ2UnLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignV0lYIE1lZGlhIHVwbG9hZCBlcnJvcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCBmaWxlIHRvIGRhdGEgVVJMXG4gICAqIEBwYXJhbSBmaWxlIC0gVGhlIGZpbGUgdG8gY29udmVydFxuICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBkYXRhIFVSTCBzdHJpbmdcbiAgICovXG4gIHByaXZhdGUgZmlsZVRvRGF0YVVybChmaWxlOiBGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nKTtcbiAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVXBsb2FkIHRodW1ibmFpbCBpbWFnZSB0byBXSVggTWVkaWEgTWFuYWdlclxuICAgKiBAcGFyYW0gZmlsZSAtIFRoZSB0aHVtYm5haWwgZmlsZSB0byB1cGxvYWRcbiAgICogQHBhcmFtIHRpdGxlIC0gVGl0bGUgZm9yIG9yZ2FuaXppbmcgdGhlIGZpbGVcbiAgICogQHBhcmFtIG1lZGlhVHlwZSAtIFR5cGUgb2YgbWVkaWEgKGdhbGxlcnkgb3IgbmV3cylcbiAgICogQHJldHVybnMgVXBsb2FkIHJlc3BvbnNlIHdpdGggV0lYIG1lZGlhIFVSTFxuICAgKi9cbiAgYXN5bmMgdXBsb2FkVGh1bWJuYWlsKFxuICAgIGZpbGU6IEZpbGUsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBtZWRpYVR5cGU6ICdnYWxsZXJ5JyB8ICduZXdzJyA9ICdnYWxsZXJ5JyxcbiAgICBwYXJlbnRGb2xkZXJJZE92ZXJyaWRlPzogc3RyaW5nXG4gICk6IFByb21pc2U8V2l4TWVkaWFSZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmb2xkZXJQYXRoID0gdGhpcy5nZW5lcmF0ZUZvbGRlclBhdGgodGl0bGUsIG1lZGlhVHlwZSk7XG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgdGltZXN0YW1wLWJhc2VkIGZpbGVuYW1lIGZvciB0aHVtYm5haWxcbiAgICAgIGNvbnN0IGV4dFRodW1iID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCkgfHwgJyc7XG4gICAgICBjb25zdCB1bmlxdWVUaHVtYk5hbWUgPSBgJHtEYXRlLm5vdygpICogMTAwMH0uJHtleHRUaHVtYn1gO1xuICAgICAgXG4gICAgICBjb25zdCBidWNrZXQgPSBtZWRpYVR5cGU7XG4gICAgICBjb25zdCBzdXBhYmFzZUZpbGVQYXRoID0gYCR7Zm9sZGVyUGF0aH0vJHt1bmlxdWVUaHVtYk5hbWV9YC5yZXBsYWNlKC9eW1xcXFwvXS8sICcnKTtcbiAgICAgIGNvbnN0IHB1YmxpY1VybCA9IGF3YWl0IHVwbG9hZEZpbGVUb1N1cGFiYXNlKGZpbGUsIGJ1Y2tldCwgc3VwYWJhc2VGaWxlUGF0aCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGltcG9ydFBheWxvYWQ6IEltcG9ydEZpbGVSZXF1ZXN0ID0ge1xuICAgICAgICB1cmw6IHB1YmxpY1VybCxcbiAgICAgICAgZGlzcGxheU5hbWU6IGAke3RpdGxlfS10aHVtYm5haWxgLFxuICAgICAgICBwYXJlbnRGb2xkZXJJZDogKHBhcmVudEZvbGRlcklkT3ZlcnJpZGUgPz8gKGF3YWl0IHRoaXMuZW5zdXJlRm9sZGVyRXhpc3RzKGZvbGRlclBhdGgpKSkgfHwgJ21lZGlhLXJvb3QnLFxuICAgICAgICBtaW1lVHlwZTogZmlsZS50eXBlLFxuICAgICAgICBtZWRpYVR5cGU6ICdJTUFHRScsXG4gICAgICAgIHByaXZhdGU6IGZhbHNlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgaW1wb3J0UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2ZpbGVzL2ltcG9ydGAsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoaW1wb3J0UGF5bG9hZCksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFpbXBvcnRSZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBpbXBvcnRSZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGltcG9ydCB0aHVtYm5haWw6ICR7aW1wb3J0UmVzcG9uc2Uuc3RhdHVzfSAke2ltcG9ydFJlc3BvbnNlLnN0YXR1c1RleHR9IC0gJHtlcnJvclRleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGltcG9ydFJlc3VsdCA9IGF3YWl0IGltcG9ydFJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmICghaW1wb3J0UmVzdWx0LmZpbGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbXBvcnQgcmVzcG9uc2UgbWlzc2luZyBmaWxlIGRhdGEnKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYW51cCBkZWZlcnJlZDoga2VlcCB0aHVtYm5haWwgdGVtcCBmaWxlIGluIFN1cGFiYXNlIHVudGlsIGdhbGxlcnkvbmV3cyBpcyBzYXZlZFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogaW1wb3J0UmVzdWx0LmZpbGUuaWQsXG4gICAgICAgIHVybDogaW1wb3J0UmVzdWx0LmZpbGUudXJsLFxuICAgICAgICBmaWxlbmFtZTogdW5pcXVlVGh1bWJOYW1lLFxuICAgICAgICBwYXRoOiBmb2xkZXJQYXRoLFxuICAgICAgICBtZWRpYVR5cGU6IGltcG9ydFJlc3VsdC5maWxlLm1lZGlhVHlwZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICB1cGxvYWRlZDogaW1wb3J0UmVzdWx0LmZpbGUuY3JlYXRlZERhdGUsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdXSVggTWVkaWEgdGh1bWJuYWlsIHVwbG9hZCBlcnJvcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVsayBpbXBvcnQgZmlsZXMgdG8gV0lYIE1lZGlhIE1hbmFnZXJcbiAgICogQHBhcmFtIGZpbGVzIC0gQXJyYXkgb2YgZmlsZXMgdG8gdXBsb2FkXG4gICAqIEBwYXJhbSB0aXRsZSAtIFRpdGxlIGZvciBvcmdhbml6aW5nIHRoZSBmaWxlc1xuICAgKiBAcGFyYW0gbWVkaWFUeXBlIC0gVHlwZSBvZiBtZWRpYSAoZ2FsbGVyeSBvciBuZXdzKVxuICAgKiBAcmV0dXJucyBBcnJheSBvZiB1cGxvYWQgcmVzcG9uc2VzXG4gICAqL1xuICBhc3luYyBidWxrVXBsb2FkSW1hZ2VzKGZpbGVzOiBGaWxlW10sIHRpdGxlOiBzdHJpbmcsIG1lZGlhVHlwZTogJ2dhbGxlcnknIHwgJ25ld3MnID0gJ2dhbGxlcnknKTogUHJvbWlzZTxXaXhNZWRpYVJlc3BvbnNlW10+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG5cbiAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgdXBsb2FkIG1vcmUgdGhhbiAxMDAgZmlsZXMgYXQgb25jZSAoV0lYIEFQSSBsaW1pdCknKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZm9sZGVyUGF0aCA9IHRoaXMuZ2VuZXJhdGVGb2xkZXJQYXRoKHRpdGxlLCBtZWRpYVR5cGUpO1xuICAgICAgXG4gICAgICAvLyBFbnN1cmUgZm9sZGVyIGV4aXN0c1xuICAgICAgY29uc3QgZm9sZGVySWQgPSBhd2FpdCB0aGlzLmVuc3VyZUZvbGRlckV4aXN0cyhmb2xkZXJQYXRoKTtcbiAgICAgIFxuICAgICAgLy8gUHJlcGFyZSBpbXBvcnQgcmVxdWVzdHMgYnkgdXBsb2FkaW5nIGVhY2ggZmlsZSB0byB0ZW1wb3JhcnkgaG9zdGluZ1xuICAgICAgY29uc29sZS5sb2coYFByZXBhcmluZyB0byB1cGxvYWQgJHtmaWxlcy5sZW5ndGh9IGZpbGVzLi4uYCk7XG4gICAgICBjb25zdCBpbXBvcnRGaWxlUmVxdWVzdHM6IEltcG9ydEZpbGVSZXF1ZXN0W10gPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgZmlsZXMubWFwKGFzeW5jIChmaWxlLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBVcGxvYWRpbmcgZmlsZSAke2luZGV4ICsgMX0vJHtmaWxlcy5sZW5ndGh9OiAke2ZpbGUubmFtZX1gKTtcbiAgICAgICAgICBjb25zdCBidWNrZXQgPSBtZWRpYVR5cGU7XG4gICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIGJhc2VkIG9uIGN1cnJlbnQgdGltZXN0YW1wXG4gICAgICAgICAgY29uc3QgZXh0ID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCkgfHwgJyc7XG4gICAgICAgICAgY29uc3QgdW5pcXVlRmlsZW5hbWUgPSBgJHtEYXRlLm5vdygpICogMTAwMH0uJHtleHR9YDtcbiAgICAgICAgICBjb25zdCBzdXBhYmFzZUZpbGVQYXRoID0gYCR7Zm9sZGVyUGF0aH0vJHt1bmlxdWVGaWxlbmFtZX1gLnJlcGxhY2UoL15cXC8vLCAnJyk7XG4gICAgICAgICAgY29uc3QgcHVibGljVXJsID0gYXdhaXQgdXBsb2FkRmlsZVRvU3VwYWJhc2UoZmlsZSwgYnVja2V0LCBzdXBhYmFzZUZpbGVQYXRoKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXJsOiBwdWJsaWNVcmwsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgcGFyZW50Rm9sZGVySWQ6IGZvbGRlcklkIHx8ICdNRURJQV9ST09UJyxcbiAgICAgICAgICAgIG1pbWVUeXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICBtZWRpYVR5cGU6ICdJTUFHRScgYXMgY29uc3QsXG4gICAgICAgICAgICBwcml2YXRlOiBmYWxzZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIGJ1bGsgaW1wb3J0IHRvIFdJWCBNZWRpYSBNYW5hZ2VyLi4uJyk7XG4gICAgICAvLyBCdWxrIGltcG9ydCB1c2luZyB0aGUgYnVsayBpbXBvcnQgQVBJXG4gICAgICBjb25zdCBidWxrSW1wb3J0UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2J1bGsvZmlsZXMvaW1wb3J0LXYyYCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaW1wb3J0RmlsZVJlcXVlc3RzLFxuICAgICAgICAgIHJldHVybkVudGl0eTogdHJ1ZSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICAgIC8vIFBhcnNlIGFuZCBoYW5kbGUgYnVsayBpbXBvcnQgcmVzcG9uc2VcbiAgICAgIGlmICghYnVsa0ltcG9ydFJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGVyclRleHQgPSBhd2FpdCBidWxrSW1wb3J0UmVzcG9uc2UudGV4dCgpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBidWxrIGltcG9ydCBmaWxlczogJHtidWxrSW1wb3J0UmVzcG9uc2Uuc3RhdHVzfSAke2J1bGtJbXBvcnRSZXNwb25zZS5zdGF0dXNUZXh0fSAtICR7ZXJyVGV4dH1gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGJ1bGtJbXBvcnRSZXN1bHQ6IEJ1bGtJbXBvcnRSZXNwb25zZSA9IGF3YWl0IGJ1bGtJbXBvcnRSZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zdCB1cGxvYWRSZXNwb25zZXM6IFdpeE1lZGlhUmVzcG9uc2VbXSA9IFtdO1xuICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgYnVsa0ltcG9ydFJlc3VsdC5yZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIHJlc3VsdC5zdWNjZXNzLmZpbGUpIHtcbiAgICAgICAgICBjb25zdCBmaWxlRGF0YSA9IHJlc3VsdC5zdWNjZXNzLmZpbGU7XG4gICAgICAgICAgdXBsb2FkUmVzcG9uc2VzLnB1c2goe1xuICAgICAgICAgICAgaWQ6IGZpbGVEYXRhLmlkLFxuICAgICAgICAgICAgdXJsOiBmaWxlRGF0YS51cmwsXG4gICAgICAgICAgICBmaWxlbmFtZTogZmlsZXNbaW5kZXhdLm5hbWUsXG4gICAgICAgICAgICBwYXRoOiBmb2xkZXJQYXRoLFxuICAgICAgICAgICAgbWVkaWFUeXBlOiBmaWxlRGF0YS5tZWRpYVR5cGUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHVwbG9hZGVkOiBmaWxlRGF0YS5jcmVhdGVkRGF0ZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuZmFpbHVyZSkge1xuICAgICAgICAgIGNvbnN0IG1zZyA9IGBGYWlsZWQgdG8gdXBsb2FkICR7ZmlsZXNbaW5kZXhdLm5hbWV9OiAke3Jlc3VsdC5mYWlsdXJlLm1lc3NhZ2V9YDtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKG1zZywgcmVzdWx0LmZhaWx1cmUpO1xuICAgICAgICAgIGVycm9ycy5wdXNoKG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwICYmIHVwbG9hZFJlc3BvbnNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbGwgZmlsZSB1cGxvYWRzIGZhaWxlZDpcXG4ke2Vycm9ycy5qb2luKCdcXG4nKX1gKTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkgY29uc29sZS53YXJuKGBTb21lIGZpbGVzIGZhaWxlZCB0byB1cGxvYWQ6XFxuJHtlcnJvcnMuam9pbignXFxuJyl9YCk7XG4gICAgICByZXR1cm4gdXBsb2FkUmVzcG9uc2VzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdXSVggTWVkaWEgYnVsayB1cGxvYWQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBtZWRpYSBmcm9tIFdJWCBNZWRpYSBNYW5hZ2VyXG4gICAqIEBwYXJhbSBtZWRpYUlkIC0gVGhlIFdJWCBtZWRpYSBJRCB0byBkZWxldGVcbiAgICogQHJldHVybnMgU3VjY2VzcyBib29sZWFuXG4gICAqL1xuICBhc3luYyBkZWxldGVNZWRpYShtZWRpYUlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2ZpbGVzLyR7bWVkaWFJZH1gLCB7XG4gICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2Uub2s7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dJWCBNZWRpYSBkZWxldGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtZWRpYSBpdGVtIGRldGFpbHNcbiAgICogQHBhcmFtIG1lZGlhSWQgLSBUaGUgV0lYIG1lZGlhIElEXG4gICAqIEByZXR1cm5zIE1lZGlhIGl0ZW0gZGV0YWlsc1xuICAgKi9cbiAgYXN5bmMgZ2V0TWVkaWFEZXRhaWxzKG1lZGlhSWQ6IHN0cmluZyk6IFByb21pc2U8V2l4TWVkaWFSZXNwb25zZSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2ZpbGVzLyR7bWVkaWFJZH1gLCB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGRhdGEuZmlsZS5pZCxcbiAgICAgICAgdXJsOiBkYXRhLmZpbGUudXJsLFxuICAgICAgICBmaWxlbmFtZTogZGF0YS5maWxlLmRpc3BsYXlOYW1lLFxuICAgICAgICBwYXRoOiBkYXRhLmZpbGUucGFyZW50Rm9sZGVySWQgfHwgJycsXG4gICAgICAgIG1lZGlhVHlwZTogZGF0YS5maWxlLm1lZGlhVHlwZSxcbiAgICAgICAgdXBsb2FkZWQ6IGRhdGEuZmlsZS5jcmVhdGVkRGF0ZSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dJWCBNZWRpYSBnZXQgZGV0YWlscyBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBtZWRpYSBmaWxlcyB3aXRoIG9wdGlvbmFsIGZpbHRlcmluZ1xuICAgKiBAcGFyYW0gZm9sZGVySWQgLSBPcHRpb25hbCBmb2xkZXIgSUQgdG8gZmlsdGVyIGJ5XG4gICAqIEByZXR1cm5zIEFycmF5IG9mIG1lZGlhIGl0ZW1zXG4gICAqL1xuICBhc3luYyBsaXN0TWVkaWEoZm9sZGVySWQ/OiBzdHJpbmcpOiBQcm9taXNlPFdpeE1lZGlhUmVzcG9uc2VbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICAgIGlmIChmb2xkZXJJZCkge1xuICAgICAgICBxdWVyeVBhcmFtcy5hcHBlbmQoJ3BhcmVudEZvbGRlcklkJywgZm9sZGVySWQpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vZmlsZXM/JHtxdWVyeVBhcmFtcy50b1N0cmluZygpfWAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbGlzdCBtZWRpYTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgcmV0dXJuIGRhdGEuZmlsZXMubWFwKChmaWxlOiBhbnkpID0+ICh7XG4gICAgICAgIGlkOiBmaWxlLmlkLFxuICAgICAgICB1cmw6IGZpbGUudXJsLFxuICAgICAgICBmaWxlbmFtZTogZmlsZS5kaXNwbGF5TmFtZSxcbiAgICAgICAgcGF0aDogZmlsZS5wYXJlbnRGb2xkZXJJZCB8fCAnJyxcbiAgICAgICAgbWVkaWFUeXBlOiBmaWxlLm1lZGlhVHlwZSxcbiAgICAgICAgdXBsb2FkZWQ6IGZpbGUuY3JlYXRlZERhdGUsXG4gICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dJWCBNZWRpYSBsaXN0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBmb2xkZXJzIGluIE1lZGlhIE1hbmFnZXJcbiAgICogQHBhcmFtIHBhcmVudEZvbGRlcklkIC0gT3B0aW9uYWwgcGFyZW50IGZvbGRlciBJRFxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBmb2xkZXIgaW5mb3JtYXRpb25cbiAgICovXG4gIGFzeW5jIGxpc3RGb2xkZXJzKHBhcmVudEZvbGRlcklkPzogc3RyaW5nKTogUHJvbWlzZTxXaXhGb2xkZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgICAgIGlmIChwYXJlbnRGb2xkZXJJZCkge1xuICAgICAgICBxdWVyeVBhcmFtcy5hcHBlbmQoJ3BhcmVudEZvbGRlcklkJywgcGFyZW50Rm9sZGVySWQpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vZm9sZGVycz8ke3F1ZXJ5UGFyYW1zLnRvU3RyaW5nKCl9YCwge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsaXN0IGZvbGRlcnM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBkYXRhLmZvbGRlcnMgfHwgW107XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dJWCBNZWRpYSBsaXN0IGZvbGRlcnMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWN1cnNpdmVseSBsaXN0IGFsbCBmb2xkZXJzIHVuZGVyIGEgZ2l2ZW4gcGFyZW50XG4gICAqIEBwYXJhbSBwYXJlbnRGb2xkZXJJZCAtIHN0YXJ0aW5nIGZvbGRlciBpZFxuICAgKiBAcmV0dXJucyBmbGF0IGFycmF5IG9mIGFsbCBzdWJmb2xkZXJzXG4gICAqL1xuICBhc3luYyBsaXN0QWxsRm9sZGVycyhwYXJlbnRGb2xkZXJJZDogc3RyaW5nID0gJ21lZGlhLXJvb3QnKTogUHJvbWlzZTxXaXhGb2xkZXJbXT4ge1xuICAgIGNvbnN0IGFsbDogV2l4Rm9sZGVyW10gPSBbXTtcbiAgICBjb25zdCBxdWV1ZTogc3RyaW5nW10gPSBbcGFyZW50Rm9sZGVySWRdO1xuXG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgY29uc3QgY3VycmVudCA9IHF1ZXVlLnNoaWZ0KCkhO1xuICAgICAgY29uc3QgY2hpbGRyZW4gPSBhd2FpdCB0aGlzLmxpc3RGb2xkZXJzKGN1cnJlbnQpO1xuICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICBhbGwucHVzaChjaGlsZCk7XG4gICAgICAgIHF1ZXVlLnB1c2goY2hpbGQuaWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhbGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZvbGRlciBkZXRhaWxzXG4gICAqIEBwYXJhbSBmb2xkZXJJZCAtIFRoZSBmb2xkZXIgSURcbiAgICogQHJldHVybnMgRm9sZGVyIGRldGFpbHNcbiAgICovXG4gIGFzeW5jIGdldEZvbGRlckRldGFpbHMoZm9sZGVySWQ6IHN0cmluZyk6IFByb21pc2U8V2l4Rm9sZGVyIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuYmFzZVVybH0vZm9sZGVycy8ke2ZvbGRlcklkfWAsIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICByZXR1cm4gZGF0YS5mb2xkZXI7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1dJWCBNZWRpYSBnZXQgZm9sZGVyIGRldGFpbHMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGZvbGRlciBpbiBXSVggTWVkaWEgTWFuYWdlclxuICAgKiBAcGFyYW0gZGlzcGxheU5hbWUgLSBUaGUgZm9sZGVyIGRpc3BsYXkgbmFtZVxuICAgKiBAcGFyYW0gcGFyZW50Rm9sZGVySWQgLSBPcHRpb25hbCBwYXJlbnQgZm9sZGVyIElEIChkZWZhdWx0cyB0byBtZWRpYS1yb290KVxuICAgKiBAcmV0dXJucyBTdWNjZXNzIGJvb2xlYW5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUZvbGRlcihkaXNwbGF5TmFtZTogc3RyaW5nLCBwYXJlbnRGb2xkZXJJZDogc3RyaW5nID0gJ21lZGlhLXJvb3QnKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9mb2xkZXJzYCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZGlzcGxheU5hbWUsXG4gICAgICAgICAgcGFyZW50Rm9sZGVySWQsXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4gZGF0YS5mb2xkZXIuaWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignV0lYIE1lZGlhIGNyZWF0ZSBmb2xkZXIgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHRodW1ibmFpbCBVUkwgZm9yIFdJWCBtZWRpYVxuICAgKiBAcGFyYW0gbWVkaWFVcmwgLSBUaGUgb3JpZ2luYWwgbWVkaWEgVVJMXG4gICAqIEBwYXJhbSB3aWR0aCAtIFRodW1ibmFpbCB3aWR0aFxuICAgKiBAcGFyYW0gaGVpZ2h0IC0gVGh1bWJuYWlsIGhlaWdodFxuICAgKiBAcmV0dXJucyBUaHVtYm5haWwgVVJMXG4gICAqL1xuICBnZXRUaHVtYm5haWxVcmwobWVkaWFVcmw6IHN0cmluZywgd2lkdGg6IG51bWJlciA9IDMwMCwgaGVpZ2h0OiBudW1iZXIgPSAzMDApOiBzdHJpbmcge1xuICAgIC8vIFdJWCBtZWRpYSBVUkxzIGNhbiBiZSBtb2RpZmllZCB3aXRoIHF1ZXJ5IHBhcmFtZXRlcnMgZm9yIHJlc2l6aW5nXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChtZWRpYVVybCk7XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3cnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgnaCcsIGhlaWdodC50b1N0cmluZygpKTtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgnZml0JywgJ2Nyb3AnKTtcbiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHdpeE1lZGlhU2VydmljZSA9IG5ldyBXaXhNZWRpYVNlcnZpY2UoKTtcbiJdLCJuYW1lcyI6WyJ1cGxvYWRGaWxlVG9TdXBhYmFzZSIsIldJWF9BUElfS0VZIiwicHJvY2VzcyIsImVudiIsIldJWF9TSVRFX0lEIiwiV0lYX0FDQ09VTlRfSUQiLCJXaXhNZWRpYVNlcnZpY2UiLCJnZW5lcmF0ZUZvbGRlclBhdGgiLCJ0aXRsZSIsIm1lZGlhVHlwZSIsIm5vdyIsIkRhdGUiLCJ5ZWFyIiwiZ2V0RnVsbFllYXIiLCJtb250aCIsIlN0cmluZyIsImdldE1vbnRoIiwicGFkU3RhcnQiLCJzYW5pdGl6ZWRUaXRsZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsImVuc3VyZUZvbGRlckV4aXN0cyIsImZvbGRlclBhdGgiLCJwYXRoUGFydHMiLCJzcGxpdCIsImZpbHRlciIsInBhcnQiLCJsZW5ndGgiLCJjdXJyZW50UGFyZW50SWQiLCJmb2xkZXJOYW1lIiwibGlzdFJlc3BvbnNlIiwiZmV0Y2giLCJiYXNlVXJsIiwibWV0aG9kIiwiaGVhZGVycyIsImZvbGRlcklkIiwib2siLCJmb2xkZXJzRGF0YSIsImpzb24iLCJleGlzdGluZ0ZvbGRlciIsImZvbGRlcnMiLCJmaW5kIiwiZiIsImRpc3BsYXlOYW1lIiwiaWQiLCJjcmVhdGVSZXNwb25zZSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicGFyZW50Rm9sZGVySWQiLCJmb2xkZXJEYXRhIiwiZm9sZGVyIiwiY29uc29sZSIsImVycm9yIiwiZmlsZVRvQmxvYlVybCIsImZpbGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImJsb2JVcmwiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJ1cGxvYWRJbWFnZSIsInBhcmVudEZvbGRlcklkT3ZlcnJpZGUiLCJsb2ciLCJuYW1lIiwiYnVja2V0IiwiZXh0IiwicG9wIiwidW5pcXVlRmlsZW5hbWUiLCJzdXBhYmFzZUZpbGVQYXRoIiwicHVibGljVXJsIiwiaW1wb3J0UGF5bG9hZCIsInVybCIsIm1pbWVUeXBlIiwidHlwZSIsInByaXZhdGUiLCJpbXBvcnRSZXNwb25zZSIsImVycm9yVGV4dCIsInRleHQiLCJFcnJvciIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJpbXBvcnRSZXN1bHQiLCJwYXJzZUVycm9yIiwidXBsb2FkZWRGaWxlIiwic3JjIiwiYWx0IiwiZmlsZVRvRGF0YVVybCIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJyZXN1bHQiLCJvbmVycm9yIiwicmVhZEFzRGF0YVVSTCIsInVwbG9hZFRodW1ibmFpbCIsImV4dFRodW1iIiwidW5pcXVlVGh1bWJOYW1lIiwiZmlsZW5hbWUiLCJwYXRoIiwidXBsb2FkZWQiLCJjcmVhdGVkRGF0ZSIsImJ1bGtVcGxvYWRJbWFnZXMiLCJmaWxlcyIsImltcG9ydEZpbGVSZXF1ZXN0cyIsImFsbCIsIm1hcCIsImluZGV4IiwiYnVsa0ltcG9ydFJlc3BvbnNlIiwicmV0dXJuRW50aXR5IiwiZXJyVGV4dCIsImJ1bGtJbXBvcnRSZXN1bHQiLCJ1cGxvYWRSZXNwb25zZXMiLCJlcnJvcnMiLCJyZXN1bHRzIiwiZm9yRWFjaCIsInN1Y2Nlc3MiLCJmaWxlRGF0YSIsInB1c2giLCJmYWlsdXJlIiwibXNnIiwibWVzc2FnZSIsImpvaW4iLCJ3YXJuIiwiZGVsZXRlTWVkaWEiLCJtZWRpYUlkIiwicmVzcG9uc2UiLCJnZXRNZWRpYURldGFpbHMiLCJkYXRhIiwibGlzdE1lZGlhIiwicXVlcnlQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJhcHBlbmQiLCJ0b1N0cmluZyIsImxpc3RGb2xkZXJzIiwibGlzdEFsbEZvbGRlcnMiLCJxdWV1ZSIsImN1cnJlbnQiLCJzaGlmdCIsImNoaWxkcmVuIiwiY2hpbGQiLCJnZXRGb2xkZXJEZXRhaWxzIiwiY3JlYXRlRm9sZGVyIiwiZ2V0VGh1bWJuYWlsVXJsIiwibWVkaWFVcmwiLCJ3aWR0aCIsImhlaWdodCIsInNlYXJjaFBhcmFtcyIsInNldCIsIndpeE1lZGlhU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/wix-media.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/ws","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fupload%2Froute&page=%2Fapi%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fupload%2Froute.ts&appDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fworkspaces%2Fcodespaces-blank%2Fwix-admin-panel&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();